/**
 * ============================================================================
 * ShadowStrike Exploits - PRIVILEGE ESCALATION DETECTOR (The Elevator)
 * ============================================================================
 *
 * @file PrivilegeEscalationDetector.hpp
 * @brief Detection of UAC Bypass and Logic Bugs.
 *
 * Detects:
 * 1. UAC Bypass: DLL hijacking in elevated processes (e.g., eventvwr.exe).
 * 2. Token Swapping: Replacing process token with a higher privileged one.
 * 3. Named Pipe Impersonation: Abusing "ImpersonateNamedPipeClient".
 *
 * @author ShadowStrike Security Team
 * @version 3.0.0
 * @copyright 2026 ShadowStrike Security Suite
 */

#pragma once

#include "../../Core/Process/ProcessMonitor.hpp"
#include <cstdint>

namespace ShadowStrike {
    namespace Exploits {

        class PrivilegeEscalationDetector {
        public:
            static PrivilegeEscalationDetector& Instance();

            /**
             * @brief Monitor process elevation events.
             * Compares Parent Token vs Child Token.
             */
            bool AnalyzeElevation(uint32_t parentPid, uint32_t childPid);

            /**
             * @brief Detect specific UAC bypass file operations.
             * e.g., Writing to System32 using IFileOperation COM interface.
             */
            bool DetectUACBypass(uint32_t pid, const std::wstring& targetPath);

        private:
            PrivilegeEscalationDetector() = default;
        };

    } // namespace Exploits
} // namespace ShadowStrike
